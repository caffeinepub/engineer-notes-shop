{
  "kind": "build_request",
  "title": "Fix admin authentication - backend owner recognition issue",
  "projectName": "Engineer Notes Shop",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Fix the backend admin check logic so that the authenticated principal 'hmeax-fs32k-burgh-dx5q3-cud51-d77j7-y6kwa-fl2po-zzjpj-c74c2-rae' is correctly recognized as admin after system initialization",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-1",
          "msg-assistant-5",
          "msg-user-6"
        ],
        "quotes": [
          "Admin Check: Not admin ✗",
          "your principal is not being recognized as the owner"
        ]
      },
      "acceptanceCriteria": [
        "After refresh, the Admin Diagnostics panel shows 'Admin Check: Admin ✓' instead of 'Not admin ✗'",
        "The authenticated user with principal 'hmeax-fs32k-burgh-dx5q3-cud51-d77j7-y6kwa-fl2po-zzjpj-c74c2-rae' can access the admin dashboard",
        "The 'Access Denied' screen no longer appears for the initialized owner"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Verify that the auto-initialization logic correctly assigns the first authenticated user as admin and persists this assignment across canister upgrades",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-assistant-5"
        ],
        "quotes": [
          "The initialization call isn't properly setting your principal as owner"
        ]
      },
      "acceptanceCriteria": [
        "When an authenticated user accesses the system for the first time, they are automatically assigned admin privileges",
        "The admin assignment persists after canister restart or upgrade",
        "The isAdmin check returns true for the initialized owner principal"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Remove or fix the 'Initialize as Owner' button functionality since auto-initialization should handle owner assignment automatically",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-assistant-5"
        ],
        "quotes": [
          "The 'Initialize as Owner' button suggests the backend is waiting for manual initialization, but clicking it hasn't worked"
        ]
      },
      "acceptanceCriteria": [
        "If auto-initialization works correctly, remove the 'Initialize as Owner' button from the AccessDeniedScreen",
        "If the button is kept, ensure it properly triggers the backend initialization and updates the UI state immediately",
        "The user experience is clear and doesn't show conflicting states (Initialized ✓ but Not admin ✗)"
      ]
    }
  ],
  "constraints": [
    "The authenticated principal 'hmeax-fs32k-burgh-dx5q3-cud51-d77j7-y6kwa-fl2po-zzjpj-c74c2-rae' must be recognized as admin",
    "Preserve the single-actor architecture in backend/main.mo",
    "Do not modify the authentication flow or Internet Identity integration"
  ],
  "nonGoals": [
    "Adding multi-admin support or role-based access control beyond owner/non-owner",
    "Changing the frontend UI design or layout",
    "Modifying the product management features"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}